import*as d from"https://cdn.skypack.dev/d3@7";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();const i=document.getElementById("json-input"),m=document.getElementById("build-btn"),g=document.getElementById("json-file");let a=d.select("#tree-svg");a.empty()&&(a=d.select("#tree-container").append("svg").attr("id","tree-svg").attr("width",800).attr("height",600));function f(o){a.selectAll("*").remove();const r={};o.forEach(e=>{r[e.id]={...e,children:[]}});let s=null;if(o.forEach(e=>{!e.prev_nodes||e.prev_nodes.length===0?s=r[e.id]:e.prev_nodes.forEach(h=>{r[h]&&r[h].children.push(r[e.id])})}),!s){alert("No root node found (node with empty prev_nodes).");return}const c=+a.attr("width"),t=+a.attr("height"),n=a.append("g").attr("transform","translate(50,50)"),l=d.tree().size([c-100,t-100]),u=d.hierarchy(s);l(u),n.selectAll(".link").data(u.links()).enter().append("line").classed("link",!0).attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y);const p=n.selectAll(".node").data(u.descendants()).enter().append("g").classed("node",!0).attr("transform",e=>`translate(${e.x},${e.y})`);p.append("circle").attr("r",20),p.append("text").attr("dy",5).attr("text-anchor","middle").text(e=>e.data.id.slice(0,6))}g.addEventListener("change",o=>{const r=o.target.files[0];if(!r)return;const s=new FileReader;s.onload=function(c){i.value=c.target.result},s.readAsText(r)});async function y(){if(i.value.trim())f(JSON.parse(i.value));else try{const r=await(await fetch("/DECO3801_public_repo/treebrunton.json")).text();i.value=r,f(JSON.parse(r))}catch(o){console.error("Failed to load default JSON:",o)}}y();m.addEventListener("click",()=>{try{const o=JSON.parse(i.value);f(o)}catch(o){alert("Invalid JSON: "+o.message)}});const v=document.getElementById("clear-btn");v.addEventListener("click",()=>{a&&(a.selectAll("*").remove(),i.value="")});
